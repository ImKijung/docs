---
id: java-update-agent
title: Java 에이전트 업데이트
description: 자바 에이전트 업데이트 방법을 제공합니다.
tags:
    - Java
    - 업데이트
---

{@include: _download-agent.mdx}

## 에이전트 업데이트 자동 설정

자바 에이전트를 업데이트하려면 서버를 재시작해야 합니다. 재시작 이전에 *whatap.agent.jar* 파일이 변경되면 애플리케이션 서버가 재시작되는 과정에서 안정적인 시스템 종료(shutdown)를 실패할 수 있습니다.

원칙적으로 자바 에이전트를 업데이트 하기 위해서는 다음의 순서로 진행해야 합니다.

1. app shutdown
1. agent jar 변경
1. app start

위 과정을 보다 쉽게 처리하기 위해 와탭의 에이전트 jar 파일명에는 버전 번호를 포함합니다. 업데이트 과정에서 최신 버전을 자동 적용하도록 설정하는 것이 중요합니다.

```bash {3} showLineNumbers
########## WHATAP ############
WHATAP_HOME=/whatap
WHATAP_JAR=`ls ${WHATAP_HOME}/whatap.agent-*.jar | sort | tail -1`
JAVA_OPTS="${JAVA_OPTS} -javaagent:${WHATAP_JAR} "
########## WHATAP ############
```

## 에이전트 삭제

애플리케이션 서버에서 JVM 옵션의 `-javaagent` 설정을 삭제한 다음 서버를 다시 시작하세요. 이후 `$WHATAP_HOME` 환경 변수를 삭제하세요.

## 에이전트 롤백

1. [와탭 모니터링 서비스](https://service.whatap.io)에서 롤백을 원하는 프로젝트를 선택하세요.

1. 왼쪽 메뉴에서 ***관리*** → ***에이전트 업데이트***를 선택하세요.

1. ***다른 버전들*** 버튼을 선택하세요.

    ![관리 - 에이전트 롤백 1](/img/agent_rollback_1.png)

1. 롤백을 원하는 버전을 선택한 다음 ***선택된 버전*** 또는 ***선택된 버전으로 모든 에이전트에 다운로드*** 버튼을 클릭하세요.

    ![관리 - 에이전트 롤백 2](/img/agent_rollback_2.png)

1. 에이전트를 설치할 때 수정한 스크립트에서 `WHATAP_JAR` 환경 변수를 롤백하려는 버전으로 변경하세요.

    ![관리 - 에이전트 롤백 JVM 수정](/img/agent_rollback_3.png)