---
id: python-transaction
title: Python 에이전트 트랜잭션
description: Python 에이전트 트랜잭션과 관련된 설정을 제공합니다.
tags:
    - Python
    - 트랜잭션
    - 설정하기
---

## 트랜잭션 프로파일링

트랜잭션 성능이 트랜잭션 시작과 종료 사이의 요약 지표들이나 속성들을 의미한다면 트랜잭션 프로파일은 트랜잭션이 수행되는 과정 중인 스텝들을 추적하는 것입니다.

트랜잭션이 느리거나 오류가 있다면 그 원인을 추적하기 위해서 수행 이력을 스텝별로 추적해야 합니다. 이것을 트랜잭션 프로파일링이라고 합니다.

와탭이 수집하는 스텝의 종류에는 크게 SQL 스텝, HTTP CALL 스텝, 메시지 스텝, SOCKET 오픈 스텝, DB 연결 스텝, 메소드 스텝 등이 있습니다. 

---

* **DB 연결 스텝**<span class='type'>START-END</span><br/>
    RDB에 대한 연결에 대한 성능을 포함합니다. 스텝 정보에는 이름, 응답시간, 에러를 포함합니다.

* **SQL 스텝**<span class='type'>START-END</span><br/>
    JDBC SQL에 대한 성능을 포함합니다. 스텝 정보에는 연결 정보, SQL문, 에러가 포함되어 있습니다.

* **HTTP Call 스텝**<span class='type'>START-END</span><br/>
    외부 http 서비스 호출에 대한 성능을 포함합니다. 스텝 정보에는 url, host, port, 응답시간, 에러가 포함됩니다.

<!-- 문의 file 오픈 혹은 사용자도 임의의 위치 지정? -->
* **Message 스텝**<span class='type'>ADD</span><br/>
    프로파일을 수집하는 과정에서 비정형적인 모든 구간에 대한 이력을 수집할 때 메시지 스텝을 사용합니다. file 오픈 혹은 사용자도 임의의 위치를 지정하는 데 사용할 수 있습니다. 

* **SOCKET 스텝**<span class='type'>ADD</span><br/>
    Socket 오픈을 표현하는 스텝입니다.

* **METHOD 스텝**<span class='type'>START-END</span><br/>
    메소드 응답시간을 추적합니다.

* **ACTIVE STATCK 스텝**<span class='type'>START-END</span><br/>
    액티브 스텝에 대한 정보를 포함합니다. 별도 스레드가 생성하여 프로파일에 추가하는 방식으로 수집합니다.

---

* **profile_step_normal_count**<span class='type'>Int</span><br/>
    기본값 `1000`<br/>
    트랜잭션 프로파일의 기본 스텝 수를 지정합니다.

* **profile_step_heavy_count**<span class='type'>Int</span><br/>
    기본값 `1020`<br/>
    프로파일 기본 스텝을 초과한 경우, 최대 heavy 스텝 수를 제한합니다. `profile_step_normal_count`에서 `profile_step_heavy_time`을 초과하는 스텝을 카운팅 합니다. 응답시간이 없는 스텝들은 수집되지 않습니다.

* **profile_step_max_count**<span class='type'>Int</span><br/>
    기본값 `1024`<br/>
    프로파일 스텝의 최대 수를 설정합니다. 수집된 프로파일 스텝 수가 이 값을 초과하면 이후 수집되는 스텝들은 모두 버려집니다. `profile_step_heavy_count`을 최대 1000으로 설정하면 `profile_step_max_count`만큼 액티브 스택이 수집됩니다.

* **profile_step_heavy_time**<span class='type'>MiliSecond</span><br/>
    기본값 `100`<br/>
    Heavy 스텝의 기준을 지정합니다. 지정된 값보다 수행 시간이 긴 경우 `profile_step_normal_count`를 초과하는 경우라도 `profile_step_heavy_count` 이내에서 기록됩니다.

* **profile_basetime**<span class='type'>MiliSecond</span><br/>
    기본값 `0`<br/>
    트랜잭션이 설정값 이하 시간 내에 종료된 경우 프로파일 정보를 수집하지 않습니다. 단 5분 단위로 최초 호출된 URL, 에러가 발생한 트랜잭션에 대한 프로파일 정보는 수집됩니다.

* **query_string_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    트랜잭션 URL의 쿼리 스트링을 함께 수집하는 기능을 활성화합니다.

* **query_string_urls**<span class='type'>String</span><br/>
    트랜잭션에서 쿼리 스트링을 수집할 URL들을 등록합니다. 여러 개를 등록할 때는 콤마(*,*)를 사용합니다.  

* **hook_method_patterns**<span class='type'>String</span><br/>
    특정 메소드의 응답시간을 측정하고 싶을 때 사용합니다. [MODULE_NAME]:[CLASS_NAME].[FUNCTION_NAME] 혹은 [MODULE_NAME]:[FUNCTION_NAME] 형식으로 값을 사용합니다. 콤마(*,*) 구분자를 통하여 여러 메소드 패턴을 지정할 수 있으며 모듈에 대한 전체 클래스나, 클래스에 대한 전체 모듈은 asterisk(*)를 사용하여 추적이 가능합니다. 

:::note    
전체 모듈 추적은 오버헤드가 발생할 수 있으니 가급적 정확한 모듈명과 메소드명에 대한 사용을 권장합니다.
:::

* **trace_error_callstack_depth**<span class='type'>Int</span><br/>
    기본값 `50`<br/>
    트랜잭션에서 에러 콜 스택을 수집할 때, 콜 스택 최대 라인수를 지정합니다. 이 데이터는 에러 통계 데이터에서 조회할 수 있습니다.       

* **trace_active_callstack_depth**<span class='type'>Int</span><br/>
    기본값 `50`<br/>
    트랜잭션에서 액티브 스택을 수집할 때, 콜 스택 최대 라인수를 지정합니다.

* **trace_active_transaction_slow_time**<span class='type'>MiliSecond</span><br/>
    기본값 `3000`<br/>
    액티브 트랜잭션의 아크 이퀄라이저에서 slow 구간의 응답 기준을 지정합니다.   

* **trace_active_transaction_very_slow_time**<span class='type'>MiliSecond</span><br/>
    기본값 `8000`<br/>
    액티브 트랜잭션의 아크 이퀄라이저에서 very slow 구간의 응답 기준을 지정합니다.  

* **trace_active_transaction_lost_time**<span class='type'>MiliSecond</span><br/>
    기본값 `300000`<br/>
    트랜잭션의 종료를 기다리는 제한 시간입니다. 5분 안에 트랜잭션이 끝나지 않는 경우 트랜잭션을 정보를 더 이상 수집하지 않습니다.  