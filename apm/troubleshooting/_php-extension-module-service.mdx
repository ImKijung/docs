## PHP 확장 모듈 및 whatap-php 서비스 수동 설정

PHP 확장 모듈(PHP Extension module), whatap-php 서비스(Service) 설치 및 선택 설치(install.sh)가 정상적으로 이루어지지 않을 경우 수동으로 설정하는 방법을 설명합니다. PHP 컴파일(Compile) 설치 등의 이유로 환경 정보를 확인할 수 없는 경우 사용합니다.

### whatap.ini 생성

```bash
$ cp /usr/whatap/php/template.ini /usr/whatap/php/whatap.ini
$ vi /usr/whatap/php/whatap.ini

# 상단에 내용 추가
; Enable whatap extension module
extension=whatap.so
whatap.license=            # 발급된 라이센스 key
whatap.server.host=        # 발급된 서버 IP
whatap.app_name=           # 웹서버 구분 APHP, FPHP (apache : APHP, php-fpm : FPHP)
whatap.app_process_name=   # apache, php-fpm 의 프로세스 이름(httpd,php-fpm)
```

|설정|설명|
|----|----|
|whatap.license|프로젝트 > 관리 > 에이전트 설치 페이지에서 발급된 라이센스 키를 확인할 수 있습니다.|
|whatap.server.host|프로젝트 > 관리 > 에이전트 설치 페이지에서 발급된 서버 IP를 확인할 수 있습니다.|
|whatap.app_name|Apache 서버는 ‘APHP’, php-fpm 은 ‘FPHP’를 사용합니다.|
|whatap.app_process_name|Apache 또는 php-fpm 의 실행 프로세스 이름 설정으로 정확한 프로세스명 입력하면, 해당 프로세스에 대한 사용 메모리를 수집합니다. 예) httpd, apach2, php-fpm, php-fpm 등.|

### PHP 명령어(CLI) 경로 확인

```bash
$ which php

/usr/bin/php
```

### whatap-php 서비스(Service) 환경 변수 설정

$WHATAP_PHP_BIN 환경 변수에 PHP CLI 명령어의 경로를 설정합니다.

```bash
$ sudo vi /etc/init.d/whatap-php

export WHATAP_PHP_BIN=    # PHP 명령어 위치(/usr/bin/php)
```

### PHP API 버전 확인

$WHATAP_PHP_BIN 환경 변수에 PHP CLI 명령어의 경로를 설정합니다.

```bash
$ sudo php -i | grep 'PHP API'

PHP API => 20100412
```

### PHP ZTS(Zend Thread Safe) 지원 여부 확인

#### apache

```bash
$ sudo apachectl -V | grep MPM

Server MPM: Prefork      # ZTS 지원 안함
Server MPM: Worker       # ZTS 지원
```

#### PHP-FPM

```bash
$ sudo php-fpm -i | grep Thread

Thread Safety => disabled       # ZTS 지원 안함
Thread Safety => enabled       	# ZTS 지원
```
