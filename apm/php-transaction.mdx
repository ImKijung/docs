---
id: php-transaction
title: PHP 에이전트 트랜잭션
description: PHP 에이전트 트랜잭션과 관련된 설정을 제공합니다.
tags:
    - PHP
    - 트랜잭션
    - 설정하기
---

## 트랜잭션 프로파일링

{@include: ../track-transactions/_transaction-profile-step.mdx}

* **whatap.profile_step_normal_count**<span class='type'>Int</span><br/>
    기본값 `1000`<br/>
    트랜잭션 프로파일의 최대 스텝 수를 지정합니다.

* **whatap.profile_step_max_count**<span class='type'>Int</span><br/>
    기본값 `1024`<br/>
    수집 가능한 프로파일 스텝의 최대 개수를 설정합니다. 수집된 프로파일 스텝 수가 이 값을 초과하면 이후 수집되는 스텝들은 모두 버려집니다.

* **whatap.profile_step_heavy_count**<span class='type'>Int</span><br/>
    기본값 `1000`<br/>
    기본 스텝의 수집 개수가 초과되면, 실행 시간이 profile_step_heavy_time을 초과하는 스텝만 수집합니다. 해당 스텝의 수집 가능한 개수를 설정합니다. Default 설정일 경우 profile_step_normal_count가 800 이면 최대 200개의 스텝이 수집됩니다.

<!-- 문장 부자연스러움 -->
* **whatap.profile_step_heavy_time**<span class='type'>Millisecond</span><br/>
    기본값 `100`<br/>
    Heavy 한 스텝의 기준을 지정합니다. 지정된 값보다 수행 시간이 긴 경우 profile_step_normal_count를 초과하는 경우라도 profile_step_heavy_count 이내에서 기록됩니다.

* **whatap.profile_basetime**<span class='type'>Millisecond</span><br/>
    기본값 `500`<br/>
    트랜잭션이 설정된 값 이하의 시간 내에 종료된 경우 프로파일 정보를 수집하지 않습니다. 단 5분 단위로 최초 호출된 URL, 에러가 발생한 트랜잭션에 대한 프로파일 정보는 수집됩니다.

* **whatap.query_string_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    트랜잭션 URL의 쿼리 스트링을 함께 수집하는 기능을 활성화합니다. whatap.query_string_urls에 등록된 URL만 적용됩니다.
 
* **whatap.query_string_urls**<span class='type'>String</span><br/>
    트랜잭션에서 쿼리 스트링을 수집할 URL들을 등록합니다.

* **whatap.whatap.profile_compile_file_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    compile_file, compile_string 함수의 추적 여부를 설정합니다. PHP 내부 함수인 compile_file, compile_string 함수는 스크립트 실행 전에 컴파일하는 함수로 Main, include, require 및 autoload 스크립트의 컴파일 시점을 확인할 수 있습니다. 스크립트 파일 경로와 실행 시간을 확인할 수 있습니다.
{@include: _php-restart-apply.mdx}

* **whatap.profile_compile_file_basetime**<span class='type'>Millisecond</span><br/>
    기본값 `200`<br/>
    실행 시간의 기준을 설정합니다. 설정한 시간을 초과하여 실행되는 경우만 정보를 수집합니다.
:::caution
whatap.profile_compile_file_basetime을 너무 작게 설정할 경우 너무 많이 수집하게 되어 서버에 부하를 줄 수 있습니다.
:::
{@include: _php-restart-apply.mdx}

* **whatap.profile_method_enabled**<span class='type'>Boolean</span><br/>
    기본값 `true`<br/>
    실행 시간이 1초(whatap.profile_method_time)를 초과하는 사용자 함수의 정보를 트랜잭션 상세 정보에서 확인할 수 있습니다.
{@include: _php-restart-apply.mdx}

* **whatap.profile_method_time**<span class='type'>Milliseconds</span><br/>
    기본값 `1000`<br/>
    whatap.profile_method_enabled 설정 수집되는 함수의 실행 시간을 설정할 수 있습니다. 
{@include: _php-restart-apply.mdx}

* **whatap.profile_method_stack_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    사용자 함수의 스택 정보를 트랜잭션 상세 정보에서 확인할 수 있습니다.
{@include: _php-restart-apply.mdx}

* **whatap.profile_internal_method_enabled**<span class='type'>Boolean</span><br/>
    기본값 `true`<br/>
    PHP 내부 함수의 추적 여부를 설정합니다. 실행 시간의 기준을 설정합니다. 설정한 시간을 초과하여 실행되는 경우만 정보를 수집합니다.
{@include: _php-restart-apply.mdx}

<!-- 두 개가 어떻게 다른지? -->
* **whatap.profile_internal_method_time**<span class='type'>Milliseconds</span><br/>
    기본값 `1000`<br/>
    whatap.profile_method_enabled 설정 수집되는 함수의 실행 시간을 설정할 수 있습니다. 
{@include: _php-restart-apply.mdx}

* **whatap.profile_internal_method_param_enabled**<span class='type'>Milliseconds</span><br/>
    기본값 `1000`<br/>
    whatap.profile_method_enabled 설정 수집되는 함수의 실행 시간을 설정할 수 있습니다. 
{@include: _php-restart-apply.mdx}

* **whatap.net_udp_flush_start**<span class='type'>Boolean</span><br/>
    기본값 `true`<br/>
    값이 `false`이면 트랜잭션 시작 시점을 수집하지 않습니다.  
:::note  
시작 시점을 수집하지 않아 진행 중인 트랜잭션 수를 계산하는 액티브 트랜잭션 정보에 조금 늦게 반영될 수 있습니다. 액티브 스테이터스는 정상적으로 표기됩니다.
:::

* **whatap.net_udp_profile_basetime_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    값이 `true`이면 설정된 응답시간보다 빠른 트랜잭션의 프로파일 정보를 수집하지 않습니다.

* **whatap.net_udp_profile_basetime**<span class='type'>Miliseconds</span><br/>
    기본값 `false`<br/>
    프로파일 정보 수집을 제외하는 트랜잭션의 응답시간을 설정합니다.
:::note
프로파일 정보를 수집하지 않기 때문에 SQL, HTTPC 등의 통계에는 반영되지 않습니다.
:::

* **whatap.net_udp_trace_ignoretime_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    값이 `true`이면 설정된 응답시간이 소요되는 트랜잭션 및 프로파일 정보를 수집하지 않습니다.

* **whatap.net_udp_trace_ignoretime**<span class='type'>Miliseconds</span><br/>
    기본값 `30`<br/>
    트랜잭션 및 프로파일 정보 수집을 제외하는 트랜잭션의 응답시간을 설정합니다.

* **whatap.shm_tx_counter_enable**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    값이 `true`이면 whatap.net_udp_trace_ignoretime_enabled 설정으로 트랜잭션의 정보 수집이 제외되는 경우 TPS, 평균 응답시간, Apdex 지표를 공유 메모리에서 수집하면 제외된 트랜잭션의 정보가 통계에 반영됩니다.
:::note
수집이 안 된 트랜잭션의 경우 TPS, 평균 응답시간, Apdex 지표에는 정상적으로 반영되지만, 그 외 통계 데이터에는 반영되지 않습니다.
:::

<!-- 추가 필요 -->
## HTTP 트랜잭션 추적

* **whatap.trace_normalize_enabled**<span class='type'>Boolean</span><br/>
    기본값 `true`<br/>
    트랜잭션 URL을 변환하여 일반화하는 기능을 활성화 합니다.


* **whatap.trace_normalize_urls**<span class='type'>String</span><br/>
    트랜잭션 URL을 변환하고 일반화할 대상 URL을 지정합니다. 호출 URL패턴을 변환하여 패스 파라미터를 제거합니다.      
:::note
예시, **/a/{v}/b** 라고 설정하면 해당 형식으로 호출되는 트랜잭션 URL은 **/a/{v}/b** 형식으로 변환됩니다. 여러 개를 등록할 때는 콤마(,)를 사용합니다.
:::

* **whatap.trace_ignore_url_set**<span class='type'>String</span><br/>
    기본값 `0`<br/>
    특정 URL을 설정하면 트랜잭션 추적 대상에서 제외됩니다. 설정된 URL은 트랜잭션 정보를 수집하지 않아, 트랜잭션 목록에서 확인되지 않습니다. 트랜잭션 추적 대상에서 제외할 URL을 지정합니다. 여러 개를 지정할 경우 콤마(,)로 구분합니다.


* **whatap.trace_ignore_url_prefix**<span class='type'>String</span><br/>
    기본값 `0`<br/>
    트랜잭션 추적 대상에서 제외할 URL prefix를 지정합니다.

* **whatap.profile_http_header_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    프로파일 내역에 http 헤더 정보를 기록하고자 할 때 사용합니다.

<!-- 기본값 "host,accept,user-agent,referer, accept-language, connection" 타입 srting -->
* **whatap.profile_http_header_ignore_keys**<span class='type'>String</span><br/>
    기본값 `host,accept,user-agent,referer, accept-language, connection`<br/>
    HTTP Header 이름을 지정해 수집 정보에서 제외하는 기능을 추가했습니다. 지정된 HTTP Header 이름의 값은 수집에서 제외되며, "#"으로 표기됩니다.

* **whatap.profile_http_parameter_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    프로파일 내역에 http 파라미터 정보를 기록하고자 할 때 사용합니다. 파라미터는 별도 보안키를 입력해야 조회할 수 있습니다.

    Get, Post 파라메터 중 text 타입의 이름과 값을 수집합니다. 최대 40개(Get 20개, Post 20개) 를 수집하며 파라메터 이름과 값은 최대 256 byte 까지 수집됩니다.

    파라메터 정보는 별도 암호화되어 전송되며, 해당 애플리케이션 서버의 */usr/whatap/php/paramkey.txt* 에 있는 키로 복호화하여 볼 수 있습니다.

* **whatap.profile_http_parameter_url_prefix**<span class='type'>String</span><br/>
    기본값 `/`<br/>
    프로파일 내역에 http 파라미터 정보를 기록할 대상 URL의 prefix를 정의 할 때 사용합니다.

* **whatap.profile_http_host_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    트랜잭션의 Host 정보를 출력합니다. 값이 `false`일 경우 트랜잭션의 URL에 URI만 표기하고, `true`일 경우 `/xxx.aaa.com/URL` 형식으로 출력됩니다.

* **whatap.biz_exceptions**<span class='type'>String</span><br/>
    기본값 `Empty`<br/>
    특정 Error 또는 Exception을 Business Exception으로 지정합니다. 히트맵에서는 에러로 표기되지 않고 통계 정보에만 수집됩니다. 수집되는 Error Class 명과 동일하게 적용합니다. 콤마를 구분자로 하여 여러 개를 등록할 수 있습니다.

* **whatap.ignore_exceptions**<span class='type'>String</span><br/>
    무시할 Exception을 등록합니다. 여기에 등록되면 에러 자체가 무시됩니다. 
    
    Exception의 경우 Custom Exception Class가 정의되어 있지 않으면, 기본으로 Exception으로 수집됩니다. 특정 Exception을 구분하기 위해서는 Custom Exception Class를 정의하고 해당 이름을 지정하면 제외할 수 있습니다.

## 트랜잭션 추적

* **whatap.trace_active_transaction_slow_time**<span class='type'>Millisecond</span><br/>
    기본값 `3000`<br/>
    수집 정보를 확인하는 대시보드의 액티브 트랜잭션 아크 이퀄라이저 그래프에서 Slow 구간으로 표기될 수 있는 트랜잭션 응답 시간의 기준을 지정합니다. 트랜잭션의 응답시간이 지정 시간을 초과할 경우 Slow 액티브 트랜잭션의 개수에 포함됩니다.

* **whatap.trace_active_transaction_very_slow_time**<span class='type'>Millisecond</span><br/>
    기본값 `8000`<br/>

* **whatap.trace_active_transaction_lost_time**<span class='type'>Millisecond</span><br/>
    기본값 `30000`<br/>
    트랜잭션의 종료를 기다리는 제한 시간 5분 안에 트랜잭션이 끝나지 않는 경우 트랜잭션을 정보를 더 이상 수집하지 않습니다. 트랜잭션의 프로파일 정보에서 “Lost Connection”를 확인할 수 있습니다.
 
* **whatap.trace_useragent_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    값이 `true`이면 트랜잭션의 유저 에이전트 정보를 수집합니다. 

* **whatap.trace_referer_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    값이 `true`이면 트랜잭션의 Refere 정보를 수집합니다.

## 트랜잭션 연계 추적

* **whatap.mtrace_enabled**<span class='type'>Boolean</span><br/>
    기본값 `false`<br/>
    트랜잭션 연계 추적 기능(MTID) 사용 여부를 설정합니다. MTID를 추적하면 등록된 모든 애플리케이션 간의 호출을 확인할 수 있습니다.

* **whatap.mtrace_rate**<span class='type'>Percentage</span><br/>
    기본값 `10`<br/>
    최초 트랜잭션이 발생할 때 발급받는 MTID(Multi Transaction ID)의 발급비율을 설정하는 옵션입니다.

* **whatap.mtrace_poid_key**<span class='type'>String</span><br/>
    기본값 `x-wtap-po`<br/>
    MTID 추적에 사용할 Caller 프로젝트 정보를 전달할 Key Name을 설정합니다.

* **whatap.mtrace_caller_key**<span class='type'>String</span><br/>
    기본값 `x-wtap-mst`<br/>
    MTID 추적에 사용할 Caller Key Name을 정합니다.

* **whatap.mtrace_callee_key**<span class='type'>String</span><br/>
    기본값 `x-wtap-tx`<br/>
    MTID 추적에 사용할 Callee Key Name을 정합니다.

* **whatap.mtrace_send_url_length**<span class='type'>Int</span><br/>
    기본값 `80`<br/>
    Http Caller는 Callee에게 자신의 URL을 넘겨줍니다. 이때 URL 길이를 제한하고 있습니다. 이 길이를 지정합니다.




