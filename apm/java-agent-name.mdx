---
id: java-agent-name
title: Java 에이전트 이름 식별
description: 모니터링 대상을 식별하기 위해 에이전트 이름 설정 방법을 제공합니다.
tags:
    - Java
    - 에이전트 이름
---

모니터링 대상을 식별하기 위해서는 이름을 구분해야 할 필요가 있습니다. 와탭 모니터링 서비스는 애플리케이션 서버 식별을 위해 해당 서버로부터 모니터링한 정보를 수집, 활용합니다. 기본으로 활용하는 정보는 애플리케이션 서버 종류, 서버 IP, 서비스 포트입니다. 이 정보들를 조합해 애플리케이션 서버를 고유 식별자로 사용합니다. 필요에 따라 사용자가 지정한 명칭을 사용하거나 패턴을 변경해 고유한 값으로 변경해 사용할 수 있습니다.

에이전트 이름은 

:::caution
* 에이전트 이름은 프로젝트 단위로 고유해야 합니다.
* 에이전트 아이디/이름을 변경하면 이전 데이터와 연결되지 않습니다.
:::

:::note
* 와탭 모니터링 서비스에서는 모니터링 대상을 오브젝트 또는 에이전트로 혼용해서 사용합니다.
:::

## 기본 이름 결정 방식

JVM 옵션으로 `whatap.onname` 설정이 없는 경우 에이전트 이름을 다음과 같은 우선 순위로 자동 부여합니다.

1. `whatap.type`을 식별합니다.
1. `whatap.type`이 서블릿 컨테이너면 애플리케이션이 사용하는 포트를 식별합니다.
1. 포트를 식별할 수 없다면 process ID(PID)를 검색합니다.
1. 식별한 정보에 IPv4 주소 3, 4번째를 추가해 최종 이름을 결정합니다.

예를 들어, IP 주소가 10.11.**12**.**13**인 서버에서 **Tomcat**이 **8080** 포트로 시작한 경우 `TC-12-13-8080` 명칭으로 에이전트 이름을 자동 부여합니다.

## 에이전트 이름 변수

사용할 수 있는 이름 변수를 다음과 같이 제공합니다.

| 변수 | 설명 |
| -- | -- |
| 문자열 | 입력한 문자열을 사용합니다. |
| {type} | 컨테이너 타입을 자동 식별해 부여합니다. <br/> 자동 식별 대상 : JAVA, TOMCAT, JBOSS, RESIN, SPRINGBOOT, JETTY, JEUS, WEBLOGIC, WEBSPHERE, UNDERTOW, PLAY |
| {ip0} | IPv4 주소 중 첫 번째 단위를 사용합니다. (예시, **10**.11.12.13 중 **10**) |
| {ip1} | IPv4 주소 중 두 번째 단위를 사용합니다. (예시, 10.**11**.12.13 중 **11**) |
| {ip2} | IPv4 주소 중 세 번째 단위를 사용합니다. (예시, 10.11.**12**.13 중 **12**) |
| {ip3} | IPv4 주소 중 네 번째 단위를 사용합니다. (예시, 10.11.12.**13** 중 **13**) |
| {pid} | Java의 Process ID(PID)를 사용합니다. |
| {port} | 애플리케이션이 Listen 하는 포트를 사용합니다. |

## 에이전트 이름 설정

시작 스크립트에 JVM 옵션을 추가해 직접 이름을 설정할 수 있습니다. 

```bash
export WHATAP_OPTS="$WHATAP_OPTS -Dwhatap.name={type}-{ip4}-{port}"
export WHATAP_OPTS="$WHATAP_OPTS -Dwhatap.okind=Aservice"
export JAVA_OPTS="$JAVA_OPTS $WHATAP_OPTS"
```

다음의 순서로 우선 순위를 가집니다.

* `-Dwhatap.name`  
    애플리케이션 명칭을 이름 변수 조합으로 설정합니다. 설정한 값이 없을 경우 기본값은 `{type}`-`{ip2}`-`{ip3}`-`{port}`입니다.

* `-Dwhatap.oname`  
    애플리케이션 명칭을 고정값으로 설정합니다

에이전트 이름과 관련해 설정할 수 있는 옵션은 다음과 같습니다.

<div class='java-name'>

| 옵션 이름 | 기본값 | Type | 설명 |
| ------- | :--: | :--: | -- |
| -Dwhatap.okind | NONE | String | 에이전트가 속한 그룹 단위를 설정합니다. |
| -Dwhatap.onode | NONE | String | 에이전트가 속한 노드 단위를 설정합니다. |
| -Dauto_oname_enabled | false | Boolean | 서버에 등록할 에이전트 이름(oname)을 서버로부터 자동 부여받는 기능을 활성화합니다. 값이 `true`이면 `-Dwhatap.name`, `-Dwhatap.oname` 옵션은 무시합니다. 수집 서버와의 통신을 통해 oname을 부여받은 다음 에이전트의 일반적인 동작을 시작합니다. |
| -Dauto_oname_prefix | agent | String | 에이전트 이름을 서버로부터 자동 부여할 때 에이전트 이름의 prefix, 보통 업무명을 사용합니다. prefix 일련번호 '1~)'를 부여합니다. `-Dauto_oname_enabled`의 값이 `true`일 때 적용됩니다. |
| -Dauto_oname_reset | 0 | Int | 서버로부터 새로운 에이전트 이름을 부여받기 위해 수정합니다. 에이전트 이름을 자동 부여하면 `whatap.oname`이라는 시스템 환경 변수로 설정됩니다. 한번 정해진 시스템 환경 변수는 자바 인스턴스가 다시 시작할 때까지 유지합니다. 리셋을 원할 때 auto_oname_reset 값을 수정하세요. 현재 설정 값과 다른 값으로 변경하면 적용됩니다. |

</div>

:::info
* 클라우드의 Scale Out 환경에서는 VM이 복사되어 사용될 수 있습니다. 따라서 오브젝트 이름이 자동 부여되는 것이 중요합니다.
* 만약 2개의 VPC 환경을 만들고 동일한 private IP를 사용하도록 네트워크를 구성한 경우 두 개의 VPC가 중복되면 안 됩니다. 예를 들어, 별도의 프로젝트로 분리하거나 `-Dwhatap.name` 옵션을 이름 변수를 서로 다른 방식으로 조합해 설정할 수 있습니다.
:::