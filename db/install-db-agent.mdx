---
id: install-db-agent
title: 에이전트 설치
description: 와탭 데이터베이스 모니터링 서비스 이용을 위한 기본 설치 방법을 안내합니다.
tags: [ 데이터베이스 모니터링, 에이전트 ]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

와탭 데이터베이스 모니터링 서비스 이용을 위한 기본 설치 방법을 안내합니다.

{@include: ../apm/_agent-signup-guide.mdx}

{@youtube: Y66Siequ2S0}

{@include: ../getting-started/_create-project.mdx}

{@include: ../getting-started/_accesskey.mdx}

## 와탭 데이터베이스 에이전트 다운로드

1. 에이전트 파일을 다운로드하세요. 다음 두 가지 방법을 이용하세요.

    * 와탭 모니터링 서비스 화면에서 ***Download*** 버튼을 선택해 다운로드할 수 있습니다.

    * 리눅스 wget 방식으로 다운로드를 할 수 있습니다. 다음 명령어를 이용하세요.

      ```bash
      wget -O whatap.agent.database.tar.gz https://service.whatap.io/download/agent/whata.agent.database.tar.gz
      ```

1. 모니터링할 데이터베이스 서버에 복사한 다음 압축을 해제하세요.

1. 압축을 해제한 폴더로 진입해서 *whatap.conf* 파일을 확인하세요. *whatap.conf* 파일에 프로젝트 액세스 키 정보 및 와탭 서버 정보, db 접속 정보를 입력하세요.

  ```ini title='whatap.conf'
  license=프로젝트 액세스 키
  whatap.server.host=13.124.11.223/13.209.172.35 // 와탭 서버 정보

  dbms=postgresql
  db=postgres
  db_ip=데이터베이스 IP
  db_port=데이터베이스 포트 
  ```

1. 다음 디렉토리에 JDBC 드라이버를 다운로드하세요. */압축해제한 폴더/jdbc*

  데이터베이스별 JDBC 다운로드 링크를 다음과 같이 안내합니다. 데이터 베이스 서버의 운영체제와 버전에 맞는 JDBC 드라이버를 다운로드하세요.
  
    * [Postgresql 9.2 버전 이상](https://jdbc.postgresql.org/download)
    * [EDB 9.2 버전 이상](https://www.enterprisedb.com/advanced-downloads)
    * [Oracle 10g R2 버전 이상)](https://www.oracle.com/database/technologies/appdev/jdbc-downloads.html)
    * Tibero JDBC Drivers: `{$TB_HOME}`/client/lib/jar/tibero\<Version\>-jdbc.jar
    * Mysql & MariaDB 5.5 버전 이상
      * [Connector/J 8.0.11](https://dev.mysql.com/downloads/connector/j/)
      * [Connector/J 5.1.46](https://dev.mysql.com/downloads/connector/j/5.1.html)
    * Mssql 2005 버전 이상
      * [Microsoft JDBC Driver 6.4 for SQL Server](https://www.microsoft.com/en-us/download/details.aspx?id=56615)
      * [Microsoft JDBC Driver 6.2 for SQL Server](https://www.microsoft.com/en-us/download/details.aspx?id=55539)

  :::note
  */압축해제한 폴더/jdbc/README.md* 파일에서 각 데이터베이스별 JDBC 드라이버 설치 경로를 확인할 수도 있습니다.
  :::

## 모니터링용 계정 생성{#uid}

데이터베이스 모니터링을 하기 위해 필요한 권한을 가진 계정을 생성합니다. root 계정으로 로그인해 계정을 생성하세요.

:::note
이미 있는 계정을 사용하고 싶다면 [DB 유저 파일 생성](#create-db-user)으로 넘어가세요. 권한이 없을 경우 정상적인 모니터링을 진행하지 못할 수 있습니다.
:::

<Tabs>
<TabItem value='postgresql' label='POSTGRESQL' >

```bash showLineNumbers
## 10 버전 이상
create user whatap with password 'DB Password'; ## 원하는 password를 입력하세요.
grant pg_read_all_stats to whatap;
 
## 10 버전 미만
create user whatap with password 'DB Password'; ## 원하는 password를 입력하세요.
alter user whatap with superuser;
 
## kill session 사용시
alter user whatap with superuser;
```

</TabItem>
<TabItem value='oracle' label='Oracle'>

```bash showLineNumbers
## 일반적인 경우
create user whatap identified by DB_PASSWORD; ## 원하는 password를 입력하세요.
grant create session to whatap;
grant select any dictionary to whatap;
 
## 12c 이상에서 멀티태넌트의 경우 (접두어 c##)
create user c##whatap identified by DB_PASSWORD; ## 원하는 password를 입력하세요.
grant create session to c##whatap;
grant select any dictionary to c##whatap;
alter user c##whatap set container_data = ALL container = CURRENT;
 
## kill session 기능 사용시
grant alter system to whatap
```

</TabItem>
<TabItem value='mysql' label='MYSQL'>

```bash showLineNumbers
create user whatap identified by 'DB_PASSWORD'; ## 원하는 password를 입력하세요.
grant process on *.* to whatap;
grant select on performance_schema.* to whatap;
grant show databases on *.* to whatap;
 
## 테이블 정보를 수집할 경우
## table list를 가져올 db명.* 또는 *.* 지정해야 table 정보를 수집합니다.
grant select on DB명.* 또는 *.* to whatap;
 
## replication 사용시
grant replication client on *.* to whatap;
grant replication slave on *.* to whatap;
 
## kill session 사용시
grant super on *.* to whatap;
```

</TabItem>
<TabItem value='mssql' label='MSSQL'>

```bash showLineNumbers
create login whatap with password='DB_PASSWORD'; ## 원하는 password를 입력하세요.
grant view server state to whatap;
create user whatap for login whatap;
grant execute to whatap;
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'Ole Automation Procedures', 1;
RECONFIGURE;
 
## kill session 사용시 - SQL Server
grant alter any connection to whatap;

## kill session 사용시 - Azure SQL Database
grant kill database connection to whatap;
```

</TabItem>
<TabItem value='tibero' label='TIBERO'>

```bash showLineNumbers
create user whatap identified by 'DB_PASSWORD'; ## 원하는 password를 입력하세요.
grant create session to whatap;
grant select any dictionary to whatap;
 
## kill session 사용시
grant alter system to whatap;
```

</TabItem>
<TabItem value='cubrid' label='CUBRID'>

시스템 계정을 사용합니다.

</TabItem>
<TabItem value='altibase' label='ALTIBASE'>

```bash
create user whatap identified by '[DB_PASSWORD]'; ## 원하는 password를 입력하세요.
```

</TabItem>
</Tabs>

:::note
* **REDIS**, **MONGODB** 플랫폼은 모니터링용 계정 생성 과정을 생략합니다.
:::

## DB 유저 파일 생성{#create-db-user}

데이터베이스 접속을 위해 암호화된 UID를 생성합니다. username과 password를 입력하고 쉘 스크립트(또는 배치 파일)를 실행하세요. 

* *uid.sh* 쉘 스크립트 파일(또는 *uid.bat* 배치 파일)은 와탭 데이터베이스 에이전트를 설치한 경로에서 찾을 수 있습니다.

* `DB_USER`와 `DB_PASSWORD` 회원 가입시 사용했던 사용자 이름과 비밀번호입니다.

```bash title='uid.sh | uid.bat'
./uid.sh DB_USER DB_PASSWORD

## 또는

./uid.bat "DB_USER" "DB_PASSWORD"
```

:::note
* 최초 한번만 설정하면 그 이후부터는 암호화된 UID를 통해 모니터링 대상 데이터베이스 서버로부터 데이터 수집을 진행합니다.
* DB 유저 파일을 생성하기 위해서는 프로젝트 액세스 키가 *whatap.conf* 파일에 입력되어 있어야 합니다. [프로젝트 액세스 키 확인](#check-accesskey)
* Azure Database 환경의 경우 `DB_USER`를 DB_USER@DB_name과 같은 형식으로 입력해야 합니다.
* `DB_USER` 또는 `DB_PASSWORD`에 특수문자가 포함될 경우 특수문자 앞에 Escape Character(\\)를 같이 입력하세요.

  ```bash title='예시'
  ./uid.sh whatap whatap\!pwd
  ```
:::

데이터베이스 모니터링을 위한 에이전트 설치를 완료했습니다. [다음 문서](after-install-db-agent)에서 설치 후 점검 사항을 확인하세요.